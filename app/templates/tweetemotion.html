{% extends "base.html" %}

{% block title %}推文情感{% endblock %}

{% block head %}
{{ super() }}

    <script src="{{url_for('static',filename='js/jquery.min.js')}}" type="text/javascript" charset="utf-8"></script>
    <script src="static/js/echarts.min.js"></script>
    <script src="static/js/worldcloud.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>
       <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-gl/dist/echarts-gl.min.js"></script>
       <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts-stat/dist/ecStat.min.js"></script>
       <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/china.js"></script>
       <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/map/js/world.js"></script>
       <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/echarts/dist/extension/dataTool.min.js"></script>
{#<link href="{{ url_for('static', filename='css/vis.css') }}" rel="stylesheet">#}

{% endblock %}

{% block navbar %}
<section class="content-header">
    <h1>推文情感</h1>
    <ol class="breadcrumb">
        <li><i class="fa fa-dashboard"></i> 当前位置</li>
        <li class="active">推文分析</li>
        <li class="active">推文情感</li>
    </ol>
</section>
{% endblock %}


{% block content %}
<div class="box box-primary">
<div id="box" style="width:1000px;height: 500px;margin: 0 auto;top:20px;"></div>
<div style="width: 900px;height: 110px;margin: 0 auto;color: #214373;margin-top: 30px">
        <p>在统计的10894条数据中，<b  style="font-size:25px">7325</b>条偏向积极情绪，<b  style="font-size:25px">3569</b>条偏向消极情绪。</p>
        <p>而再细致对比情绪参数，可以发现大多情况下积极情绪和消极情绪的概率相近，即态度<b>中立</b>，根据计算，得出如下情感分析结果。</p>
</div>
<div id="box2" style="width:1000px;height: 350px;margin: 0 auto;"></div>
    </div>
<script type="text/javascript">
        // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('box'));
    // 指定图表的配置项和数据
    var pos=new Array();
    var neg=new Array();
    var posneg=new Array();
    var dates=new Array();
    var tweets=new Array();

    var count=0;
    {% for i in tweet %}
        tweets[count]="{{ i }}";
        count++;
        {% endfor %}

    var count=0;
    {% for i in pos_neg %}
        posneg[count]="{{ i }}";
        count++;
        {% endfor %}

    var count=0;
    {% for i in posrate %}
        var j = tweets[count];
        pos[count]={value:{{ i }} , tweet:j};
        count++;
        {% endfor %}

    var count=0;
    {% for i in negrate %}
        neg[count]={{ i }};
        count++;
        {% endfor %}

    var count=0;
    {% for i in date %}
        dates[count]="{{ i }}";
        count++;
        {% endfor %}

    option = {
    tooltip: {
        trigger: 'axis',
            formatter: function (params, ticket, callback) {
          var htmlStr = '';
          for(var i=0;i<params.length;i++){
        	var param = params[i];
        	var xName = param.name;//x轴的名称
        	var seriesName = param.seriesName;//图例名称
        	var value = param.value;//y轴值
        	var color = param.color;//图例颜色

        	if(i===0){
        	  htmlStr += xName + '<br/>';//x轴的名称

        	}
        	htmlStr +='<div>';
        	//为了保证和原来的效果一样，这里自己实现了一个点的效果
        	htmlStr += '<span style="margin-right:5px;display:inline-block;width:10px;height:10px;border-radius:5px;background-color:'+color+';"></span>';

        	//圆点后面显示的文本
        	htmlStr += seriesName + '：' + value ;

        	htmlStr += '</div>';
          }
          htmlStr += '推文内容：' + params[0].data.tweet;
          return htmlStr;
         },
            extraCssText:'width:250px; white-space:pre-wrap',
            position: function (pt) {
            return [pt[0], '10%'];
        },
        axisPointer: {            // 坐标轴指示器，坐标轴触发有效
            type: 'shadow'        // 默认为直线，可选为：'line' | 'shadow'
        }
    },
    title:{
          text:'特朗普推文情感概率',
{#          subtext:'不包含转推',#}
          x:'center',

        },
    legend: {
        data: ['消极', '积极'],
        top:'5%',
{#        textStyle:{#}
{#                            color: '#fff'//字体颜色#}
{#                        },#}
    },
    grid: {
        left: '3%',
        right: '4%',
        bottom: '10%',
        containLabel: true
    },
    xAxis: [
        {
            type: 'category',
            data: dates,
{#            axisLabel: {#}
{#                textStyle: {#}
{#                    color: '#fff'#}
{#                },#}
{#            },#}
        },

    ],
    yAxis: [
        {
            minInterval : 0.1,
            type: 'value',
            axisTick: {
                show: false
            },
{#            axisLabel: {#}
{#                textStyle: {#}
{#                    color: '#fff'#}
{#                },#}
{#            },#}

        }
    ],
    dataZoom: [{
        type: 'inside',
        start: 0,
        end: 3
    }, {
        start: 0,
        end: 3,
        handleIcon: 'M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z',
        handleSize: '80%',
        handleStyle: {
            color: '#fff',
            shadowBlur: 3,
            shadowColor: 'rgba(0, 0, 0, 0.6)',
            shadowOffsetX: 2,
            shadowOffsetY: 2
        }
    }],
    series: [
        {
            name: '积极',
            type: 'bar',
            stack: '总量',
            label: {
{#                show: true,#}
                rotate:40
            },
            data: pos
        },
        {
            name: '消极',
            type: 'bar',
            stack: '总量',
            label: {
{#                show: true,#}
                rotate:40
            },
            data: neg
        }
    ]
};
    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
</script>

    <script type="text/javascript">

    var pos = 0;
    var neg = 0;
    var i = 0 ;

        pos = {{ pos }};

        neg = {{ neg }};

        neu = {{ neu }};

        // 基于准备好的dom，初始化echarts实例
    var myChart = echarts.init(document.getElementById('box2'));
    // 指定图表的配置项和数据
    option = {
        title:{
          text:'特朗普推文情感分析结果',
{#          subtext:'不包含转推',#}
          x:'center',
        },
        tooltip: {
            trigger: 'item',
        },
        color: ['#003366','#4cabce', '#e5323e'],
        stillShowZeroSum: false,
        series: [
            {
                name: '推文情感',
                type: 'pie',
                radius: '70%',
                data: [
                    {value: pos, name: '积极情绪'},
                    {value: neu, name: '无情绪'},
                    {value: neg, name: '消极情绪'}
                ],
                itemStyle: {
                    emphasis: {
                        shadowBlur: 100,
                        shadowOffsetX: 0,
                        shadowColor: 'rgba(128, 128, 128, 0.5)'
                    }
                }
            }
        ]
    };
    // 使用刚指定的配置项和数据显示图表。
    myChart.setOption(option);
</script>
{% endblock %}